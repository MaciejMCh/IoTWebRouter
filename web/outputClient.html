<!DOCTYPE html>  <meta charset="utf-8" />  
<title>WebSocket Test</title>  
<br><label for="male">Name</label><input type="text" name="txt" id="name"/>
<br><label for="male">Interface ID</label><input type="text" name="txt" id="interfaceID"/>
<br><label for="male">Data type</label><input type="text" name="txt" id="dataType"/>
<br><label for="male">Data value</label><input type="text" name="txt" id="dataValue"/>
<br><input type="button" value="Start" onclick="testWebSocket();">
<br><input type="button" value="Simulate disconnect" onclick="simulateDisconnect();"><input style="width:calc(100% - 100px);" type="text" name="txt" id="logQuery"/>  
<script language="javascript" type="text/javascript">  

var wsUri = "wss://iotwebrouter.herokuapp.com/device";
// var wsUri = "ws://localhost:8080/IoTWebRouter/actions";
var output;

var name;
var interfaceID;
var dataType;
var dataValue;
var isInput;
var sessionID;

var first;


  function simulateDisconnect() {
    websocket.close();
  }


  function init() { 
  	output = document.getElementById("output"); 
  }  

  function testWebSocket() { 

	var txtbox = document.getElementById("name");
    name = txtbox.value;

    txtbox = document.getElementById("interfaceID");
    interfaceID = txtbox.value

    txtbox = document.getElementById("dataType");
    dataType = txtbox.value

    txtbox = document.getElementById("dataValue");
    dataValue = txtbox.value


  	websocket = new WebSocket(wsUri); 
  	websocket.onopen = function(evt) { 
  		onOpen(evt) 
  	}; 
  	websocket.onclose = function(evt) { 
  		onClose(evt) 
  	}; 
  	websocket.onmessage = function(evt) {
  	 onMessage(evt) 
  	};
  	 websocket.onerror = function(evt) {
  	  onError(evt) 
  	}; 
  }  

  function onOpen(evt) {
   writeToScreen("CONNECTED"); 

   doSend("{\"action\":\"register\",\"stored_id\":\""+ sessionID +"\",\"device\":{\"name\":\"" + name + "\",\"interface\":[{\"direction\":\"output\",\"dataType\":\"" + dataType + "\",\"id\":\"" + interfaceID + "\"}]}}"); 

   if (first != 1) {
    sendData();
    first = 1;
   }
} 

function sendData() {
	doSend("{\"stored_id\":\""+ sessionID +"\",\"action\":\"data\",\"interfaces\":[{\"dataType\":\""+ dataType +"\",\"id\":\""+interfaceID+"\",\"value\":"+dataValue+"}]}");
	setTimeout(sendData, 1000);
}

 function onClose(evt) {
 	writeToScreen("DISCONNECTED");
  testWebSocket();
 } 

 function onMessage(evt) { 
 	writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>'); 
  var json = JSON.parse(evt.data);
  this.sessionID = json["device_id"];
 } 

 function onError(evt) {
 	writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data); 
 }  

 function doSend(message) { 

  if (websocket.readyState == 1) {
    writeToScreen("SENT: " + message);  
    websocket.send(message); 
  }
 }  

 function writeToScreen(message) { 
 	var pre = document.createElement("p"); 
 	pre.style.wordWrap = "break-word"; 
 	pre.innerHTML = message; 
 	output.appendChild(pre); 
 }  

 window.addEventListener("load", init, false);  </script>  <h2>Output client</h2>  <div id="output"></div>